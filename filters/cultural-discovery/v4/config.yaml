# Cultural Discovery Filter - Version 4.0
# Surfaces articles about art, culture, history discoveries and cross-cultural connections
# Target: ovr.news (Wisdom tab) and Busara
# v4: Migrated to Gemma-3-1B (from Qwen2.5-1.5B), aligned inference with v6 template

filter:
  name: cultural-discovery
  version: "4.0"
  created: "2026-02-19"
  description: "Rate content for cultural discovery and cross-cultural connection value"
  focus: "DISCOVERIES about art, culture, history AND CONNECTIONS between peoples/civilizations"

  changelog:
    - version: "4.0"
      date: "2026-02-19"
      changes:
        - "Migrated from Qwen2.5-1.5B to Gemma-3-1B"
        - "Aligned inference code with uplifting v6 template"
        - "Added score calibration support (isotonic regression)"
        - "Uses load_base_model_for_seq_cls() for Gemma-3 compatibility"
        - "Enriched training data: 8,029 articles (v3 7,827 + 202 active learning)"
    - version: "3.0"
      date: "2026-01-30"
      changes:
        - "Merged v1 (4,996) + v2 (2,919) datasets = 7,827 unique articles"
        - "2.7x more training data than v2"
        - "Better distribution: 88% low, 10% med, 2% high (vs v1's 93/6/1)"
        - "Training for 6 epochs (vs v2's 3)"
        - "Head+tail preprocessing maintained"
    - version: "2.0"
      date: "2026-01-29"
      changes:
        - "Applied screening filter to training data collection"
        - "Fixed regression-to-mean problem from v1 (94% low-scoring)"
    - version: "1.0"
      date: "2026-01-28"
      changes:
        - "Initial version with 10K random articles"

  target_publications:
    - ovr.news (Wisdom tab)
    - Busara

prefilter:
  enabled: true
  expected_pass_rate: ~0.15
  description: "Blocks political conflict framing, tourism fluff, celebrity news, cultural war content"

oracle:
  recommended: gemini-flash
  target_model: "Gemini Flash 2.5"

preprocessing:
  head_tail:
    enabled: true
    head_tokens: 256
    tail_tokens: 256
    separator: " [...] "

scoring:
  dimensions:
    discovery_novelty:
      weight: 0.25
      category: discovery
      description: "New finding, revelation, or insight about art/culture/history"

    heritage_significance:
      weight: 0.20
      category: discovery
      description: "Cultural or historical importance of the subject matter"

    cross_cultural_connection:
      weight: 0.25
      category: connection
      description: "Bridges between different peoples, traditions, or civilizations"

    human_resonance:
      weight: 0.15
      category: connection
      description: "Connects to lived human experience, not just dry facts"

    evidence_quality:
      weight: 0.15
      category: assessment
      description: "How well-researched and documented is the content?"
      gatekeeper: true
      gatekeeper_threshold: 3
      gatekeeper_max_score: 3.0

  tiers:
    high:
      threshold: 7.0
      description: "Significant discovery or deep cross-cultural insight, well-documented"
    medium:
      threshold: 4.0
      description: "Meaningful cultural content with some discovery or connection value"
    low:
      threshold: 0.0
      description: "Superficial, speculative, or single-culture content without insight"

training:
  dataset: "datasets/training/cultural-discovery_v4"
  train_samples: 6421
  val_samples: 803
  test_samples: 805
  total_samples: 8029
  train_val_test_split: [0.8, 0.1, 0.1]

  distribution:
    low_percent: 87.6
    medium_percent: 10.6
    high_percent: 1.8

  hyperparameters:
    epochs: 6
    batch_size: 8
    learning_rate: 2e-5
    max_length: 512
    use_head_tail: true
    head_tokens: 256
    tail_tokens: 256

  recommended_model: "google/gemma-3-1b-pt"
  expected_mae: "<0.75"

hybrid_inference:
  stage1:
    embedding_model: "intfloat/multilingual-e5-small"
    probe_path: "probe/embedding_probe_e5small.pkl"
    threshold: 1.25  # Calibrated: 3% FN on MEDIUM+, 1.51x speedup
  stage2:
    model: "current"  # Uses existing inference.py CulturalDiscoveryScorer

deployment:
  inference_time: "20-50ms"
  cost_per_article: "$0.00"
  use_cases:
    - "ovr.news Wisdom tab curation"
    - "Busara content discovery"
    - "Cultural heritage aggregation"
