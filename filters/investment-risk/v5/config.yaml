# Investment Risk Filter Configuration v5.0
# ORTHOGONAL DIMENSION REDESIGN - Fixes v4 correlation crisis

filter:
  name: investment-risk
  version: "5.0"
  created: "2025-11-30"
  description: "Capital preservation filter with orthogonal dimensions"
  philosophy: "You can't predict crashes, but you can prepare for them."
  changelog_v5: |
    ORTHOGONAL DIMENSION REDESIGN: v4 had severe correlation crisis (27 pairs > 0.70,
    15 pairs > 0.85, macro ↔ systemic = 0.97). Model learned 2-3 concepts instead of 8.
    v5 redesigns dimensions to answer DIFFERENT questions:
    - Risk Domain Type: WHERE in financial system?
    - Severity Magnitude: HOW BAD if it materializes?
    - Materialization Timeline: WHEN would impact hit?
    - Evidence Quality: HOW documented? (GATEKEEPER)
    - Impact Breadth: WHO is affected?
    - Retail Actionability: CAN hobby investors respond?

    Inspired by uplifting v5 (which fixed 0.97 → 0.76 correlation) and
    sustainability_technology LCSA framework.

# Scoring dimensions and weights (6 orthogonal dimensions)
scoring:
  dimensions:
    # RISK CHARACTERIZATION (What Kind of Risk)

    risk_domain_type:
      weight: 0.20
      description: "WHERE in the financial system is the risk?"
      scale:
        0-2: "Not financial (gaming, entertainment, tech products, individual stocks)"
        3-4: "Single sector/industry (retail, tech, healthcare specific)"
        5-6: "Asset class level (equities broadly, bonds, real estate sector)"
        7-8: "Multi-asset (cross-market, multiple sectors, currencies + commodities)"
        9-10: "Core financial system (banks, credit markets, central banks, systemic)"
      orthogonal_note: "GTA 6 delay = 1, Fed meeting = 9, but both can have similar timelines"

    severity_magnitude:
      weight: 0.25
      description: "HOW BAD could this be if it materializes?"
      scale:
        0-2: "Negligible (routine fluctuation, normal market volatility)"
        3-4: "Minor (5-10% drawdown, single sector correction)"
        5-6: "Moderate (10-20% drawdown, multi-sector impact)"
        7-8: "Severe (20-40% drawdown, bear market conditions)"
        9-10: "Catastrophic (>40% crash, 2008-level, systemic failure)"
      orthogonal_note: "Climate risk = 9 severity but timeline = 2; Fed meeting = 2 severity but timeline = 9"

    materialization_timeline:
      weight: 0.15
      description: "WHEN would the impact materialize?"
      scale:
        0-2: "Already priced in / Historical analysis / 5+ years out"
        3-4: "Long-term (3-5 years)"
        5-6: "Medium-term (1-3 years)"
        7-8: "Short-term (3-12 months)"
        9-10: "Immediate (0-3 months, unfolding now, already happening)"
      orthogonal_note: "Severity and timeline are INDEPENDENT - severe risks can be distant"

    # ASSESSMENT DIMENSIONS (How Real/Actionable)

    evidence_quality:
      weight: 0.15
      description: "HOW well documented is this risk signal?"
      gatekeeper: true
      gatekeeper_threshold: 4
      gatekeeper_rule: "Evidence < 4 caps overall signal at 3.0 (speculation penalty)"
      scale:
        0-2: "Pure speculation (FOMO, clickbait, 'could/might/may', no data)"
        3-4: "Opinion with limited data (blog posts, newsletters)"
        5-6: "Financial journalism with data (WSJ, Bloomberg, FT analysis)"
        7-8: "Official sources, hard data (central bank, government stats)"
        9-10: "Exceptional rigor (academic studies, IMF/BIS reports, verified data)"
      orthogonal_note: "High evidence academic paper can have low actionability"

    impact_breadth:
      weight: 0.15
      description: "WHO is affected by this risk?"
      scale:
        0-2: "Individual/single company (stock tips, single stock analysis)"
        3-4: "Single sector/industry (gaming, entertainment, specific niche)"
        5-6: "Multiple sectors or regional (tech + financials, European markets)"
        7-8: "National economy, broad market (US equities, all sectors)"
        9-10: "Global, systemic, all investors (financial system, worldwide)"
      orthogonal_note: "Climate risk = 9 breadth but 2 actionability; stock tip = 2 breadth but 8 timeline"

    retail_actionability:
      weight: 0.10
      description: "CAN a hobby investor (10K-500K) respond meaningfully?"
      scale:
        0-2: "Not actionable (derivatives, institutional only, academic, stock picking)"
        3-4: "Limited (complex strategies, timing-dependent, expert knowledge)"
        5-6: "Moderate (requires analysis, some complexity, careful execution)"
        7-8: "Good (simple rebalancing, clear direction, ETF-level)"
        9-10: "High (immediate simple action, clear triggers, raise cash/buy index)"
      orthogonal_note: "Academic research = 9 evidence but 1 actionability"

  # Correlation targets (measured vs. oracle scores)
  correlation_targets:
    max_pairwise: 0.75  # No pair should exceed this
    pairs_above_70: 0   # Target: 0 pairs > 0.70 (v4 had 27!)
    pairs_above_85: 0   # Target: 0 pairs > 0.85 (v4 had 15!)
    pc1_variance: 0.60  # Target: PC1 < 60% (v4 was 87%!)

  # Signal tier classification (computed by postfilter, not oracle)
  tier_thresholds:
    RED:
      condition: "risk_domain_type >= 7 AND severity_magnitude >= 7 AND materialization_timeline >= 7 AND evidence_quality >= 5"
      description: "Act now - reduce risk immediately"
      min_score: 7.0

    YELLOW:
      condition: "(severity_magnitude >= 5 OR risk_domain_type >= 6) AND evidence_quality >= 4 AND materialization_timeline >= 5"
      description: "Monitor closely - prepare for defense"
      min_score: 4.5

    GREEN:
      condition: "severity_magnitude >= 6 AND materialization_timeline <= 4 AND evidence_quality >= 6 AND retail_actionability >= 5"
      description: "Consider accumulating - opportunity emerging"
      min_score: 4.0
      note: "Counter-cyclical opportunity when long-term severe risk is well-documented"

    BLUE:
      condition: "evidence_quality >= 7 AND retail_actionability <= 3"
      description: "Educational - understand but no action"

    NOISE:
      condition: "risk_domain_type <= 3 OR evidence_quality < 3 OR flagged content"
      description: "Ignore - not investment-relevant"

  # Content type flags (applied during scoring)
  content_flags:
    stock_picking:
      description: "Individual stock recommendations"
      cap_all_dimensions: 2

    fomo_speculation:
      description: "FOMO, meme stocks, crypto pumping"
      cap_all_dimensions: 2

    affiliate_marketing:
      description: "Sponsored content, affiliate links"
      cap_all_dimensions: 2

    clickbait:
      description: "Sensationalist without substance"
      cap_evidence: 2

    academic_research:
      description: "Purely theoretical, not actionable"
      cap_actionability: 2
      note: "Can still have high evidence quality"

# Prefilter configuration
prefilter:
  version: "1.0"
  target_pass_rate: "40-70%"
  categories:
    - fomo_speculation
    - stock_picking
    - affiliate_marketing
    - clickbait
    - non_financial

# Ground truth generation
ground_truth:
  oracle_model: "gemini-flash"
  target_labeled: 5000
  sample_strategy: "random"

# Training configuration
training:
  model_architecture: "qwen-2.5-1.5b"
  lora_rank: 16
  target_mae: 0.80
  correlation_validation: true

# Hybrid inference (two-stage pipeline)
hybrid_inference:
  stage1:
    embedding_model: "intfloat/multilingual-e5-small"
    probe_path: "probe/embedding_probe_e5small.pkl"
    threshold: 1.50  # 0.8% FN on actionable tiers, 1.07x speedup on val data
  stage2:
    model: "current"  # Uses existing inference.py InvestmentRiskScorer

# Deployment
deployment:
  pipeline:
    - prefilter
    - model
    - postfilter
  expected_latency_ms: 30
